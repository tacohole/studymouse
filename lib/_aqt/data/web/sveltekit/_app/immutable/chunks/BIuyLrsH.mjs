import"./BbkoyQuY.mjs";import{i as he}from"./-ESH3Vzs.mjs";import{v as Yt,d as pt,c as me,o as bt,e as E,s as de}from"./CAm1qXYJ.mjs";import{p as ue,aY as yt,h as B,W as te,b as Q,j as z,c as P,d as fe,aL as X,f as le,i as ne,Y as G,r as V,u as ge,k as re,b6 as Ie,n as we,t as De,g as e,s as u,m as x,aM as Jt,e as _t,l as be,a as Fe,b8 as it,ai as Oe,al as Vt,b9 as ut,b7 as ft}from"./D0Kcqh4a.mjs";import{p as _,a as Re,b as dt,s as Ce,i as Ae}from"./8hkm7YIM.mjs";import{r as Gt,aw as Qt,t as Ne,q as We,I as Xt,bI as Zt,bJ as en,bK as tn,bL as nn,U as St}from"./Ch7ZtZmv.mjs";import{p as an,e as Tt,i as sn}from"./B9FzK2Aa.mjs";import{b as kt}from"./B0hvKUPm.mjs";import{r as on,p as ke,d as ln,e as rn,S as Le,g as $e,o as cn,b as wt,f as un,s as fn,h as gt,a as dn,i as gn}from"./Dg4D5_bH.mjs";import{s as ye,x as hn}from"./BfDh-mSI.mjs";import{k as mn}from"./_2ytY-Gb.mjs";import{b as O,I as Ct,a as ze,t as vn,l as pn,q as bn,s as yn}from"./pYEVaWiA.mjs";import{a as Ge,W as At,P as Nt,D as Ue}from"./D3ZK_B5Q.mjs";import{c as _n}from"./dPqBMmTD.mjs";import{b as Qe}from"./Dm-VOW7A.mjs";import{B as Sn}from"./xV9jLUMk.mjs";import{W as Tn}from"./DYn6QD_Z.mjs";function Pt(a){const t=a.getRootNode();return t.getSelection?t.getSelection():document.getSelection()}function kn(a){const t=a.rangeCount;return t===0?null:a.getRangeAt(t-1)}const ka=Symbol("direction"),Xe=Symbol("tagActionsShortcuts");function wn(a,t,f){document.execCommand(a,t,f)}function Dt(a,t,f){if(!a.parentNode||a===t)return f;{const i=a.parentNode,w=[Array.prototype.indexOf.call(a.parentNode.childNodes,a),...f];return Dt(i,t,w)}}function ht(a,t){return Dt(a,t,[])}function Ze(a,t){if(t.length===0)return a;if(a.childNodes[t[0]]){const[f,...i]=t;return Ze(a.childNodes[f],i)}else return null}var et=(a=>(a[a.Before=-1]="Before",a[a.Equal=0]="Equal",a[a.After=1]="After",a))(et||{});function Cn(a,t){const f=Math.min(a.coordinates.length,t.coordinates.length);for(let i=0;i<=f;i++){if(a.coordinates.length===i)return t.coordinates.length===i?a.offset<t.offset?-1:a.offset>t.offset?1:0:-1;if(t.coordinates.length===i)return 1;if(a.coordinates[i]<t.coordinates[i])return-1;if(a.coordinates[i]>t.coordinates[i])return 1}throw new Error("compareLocations: Should never happen")}function An(a){const t=Pt(a),f=kn(t);if(!f)return null;const i=f.collapsed,m={coordinates:ht(t.anchorNode,a),offset:t.anchorOffset};if(i)return{anchor:m,collapsed:i};const l={coordinates:ht(t.focusNode,a),offset:t.focusOffset},d=Cn(m,l)===et.After?"backward":"forward";return{anchor:m,focus:l,collapsed:i,direction:d}}function Nn(a){a.empty()}function Pn(a,t,f,i){const w=i.focus,m=w.offset,g=Ze(a,w.coordinates);i.direction==="forward"?(f.setEnd(g,m),t.addRange(f)):(t.addRange(f),t.extend(g,m))}function Dn(a){return An(a)}function $n(a,t){const f=Pt(a);Nn(f);const i=new Range,w=Ze(a,t.anchor.coordinates);i.setStart(w,t.anchor.offset),t.collapsed?(i.collapse(!0),f.addRange(i)):Pn(a,f,i,t)}Gt("anki/location",{Position:et,restoreSelection:$n,saveSelection:Dn});const oe="∷";function Ve(a){return a.replace(/::/g,oe)}function qe(a){return a.replace(/\u2237/gu,"::")}function mt(a){let t=a.trim();for(;t.startsWith(":")||t.startsWith(oe);)t=t.slice(1).trimStart();for(;t.endsWith(":")||t.endsWith(oe);)t=t.slice(0,-1).trimEnd();return t}function Ye(a){return{id:Math.random().toString(36).substring(2),name:a,selected:!1,flash:()=>{}}}function En(a){return a.name}const Ee=pt(null);Yt(Ee,a=>()=>a==null?void 0:a.blur());var In=B('<input type="text" tabindex="-1" size="1"/>');function Rn(a,t){ue(t,!1);const[f,i]=Re(),w=()=>Ce(Ee,"$currentTagInput",f);let m=_(t,"id",8,void 0),g=_(t,"class",8,""),l=_(t,"name",12),c=_(t,"input",12),d=_(t,"disabled",8);const h=me();function C(){return c().selectionStart===c().selectionEnd}function T(){return c().selectionStart===0&&c().selectionEnd===0}function v(){return c().selectionStart===c().value.length&&c().selectionEnd===c().value.length}function s(o){c().setSelectionRange(o,o)}function D(){return l().length===0}async function $(o){const p=c().value.length;h("tagjoinprevious"),await X(),s(c().value.length-p),o.preventDefault()}async function I(o,p){if(p>l().length)return;l().slice(0,p).endsWith(oe)&&(l(l().slice(0,p-1)+l().slice(p,l().length)),await X(),o.preventDefault(),s(p-1),h("taginput"))}function R(o){T()?$(o):I(o,c().selectionStart)}async function W(o){const p=c().value.length;h("tagjoinnext"),await X(),s(p),o.preventDefault()}function Z(o){v()?W(o):I(o,c().selectionStart+2)}function k(){l(mt(l())),l().length===0&&h("tagdelete"),h("tagaccept")}function F(o){h("tagsplit",{start:c().selectionStart,end:c().selectionEnd}),o.preventDefault()}async function N(o,p=!1){const L=c().selectionStart,Y=c().selectionEnd,K=l().slice(0,L),q=l().slice(Y,l().length);if(K.endsWith(oe)){o.preventDefault(),o.stopPropagation();return}else if(K.endsWith(":")){o.preventDefault(),l(`${K.slice(0,-1)}${oe}${l().slice(Y,l().length)}`),await X(),s(L),h("taginput");return}else if(q.startsWith(":"))o.preventDefault(),l(`${K}${oe}${l().slice(Y+1,l().length)}`);else{if(p)return;o.preventDefault(),l(`${K}${oe}${q}`)}await X(),s(L+1),h("taginput")}function b(o){switch(o.key){case"Enter":F(o);break;case"Backspace":C()&&R(o);break;case"Delete":C()&&Z(o);break}ln(o)?D()?$(o):T()&&(h("tagmoveprevious"),o.preventDefault()):rn(o)?D()?W(o):v()&&(h("tagmovenext"),o.preventDefault()):o.key===" "?N(o,!1):o.key===":"&&N(o,!0)}function H(o){const p=document.getSelection();o.clipboardData.setData("text/plain",qe(p.toString()))}async function A(o){H(o);const p=c().selectionStart,L=c().selectionEnd;l(l().slice(0,p)+l().slice(L)),await X(),s(p),h("taginput")}function M(o){if(!o.clipboardData)return;const L=(l()+o.clipboardData.getData("text/plain")).split(/\s+/).map(mt).filter(K=>K.length>0).map(Ve);if(L.length===0)return;const Y=L.pop();for(const K of L.reverse())l(K),h("tagadd");l(Y)}function ae(o){l().length===0&&(o.preventDefault(),o.stopPropagation(),h("tagselectall"))}const{selectAllShortcut:se}=yt(Xe);bt(()=>{on(ae,se,{target:c()}),c().focus()});function j(o){return dt(Ee,o),{destroy(){w()===o&&dt(Ee,null)}}}he();var S=In();Qt(S);let U;Qe(S,o=>c(o),()=>c()),te(()=>_n(S,l)),te(()=>E("focus",S,function(o){O.call(this,t,o)})),te(()=>E("blur",S,ke(k))),te(()=>E("keydown",S,b)),te(()=>E("keydown",S,function(o){O.call(this,t,o)})),te(()=>E("keyup",S,function(o){O.call(this,t,o)})),te(()=>E("input",S,()=>h("taginput"))),te(()=>E("copy",S,ke(H))),te(()=>E("cut",S,ke(A))),te(()=>E("paste",S,ke(M))),Ge(S,o=>j==null?void 0:j(o)),Q(o=>{var p;Ne(S,"id",m()),U=We(S,1,`tag-input ${(p=g())!=null?p:""}`,"svelte-1nk8ij0",U,o)},[()=>({disabled:d()})],z),P(a,S),fe(),i()}var Wn=B("<!> <!>",1),jn=B('<div class="tag-add-button svelte-1fo7hj6" role="button"><!> <span class="tags-info svelte-1fo7hj6"><!></span></div> <!>',1);function xn(a,t){ue(t,!1);const[f,i]=Re(),w=()=>Ce(Ee,"$currentTagInput",f);let m=_(t,"keyCombination",8);const g=me();function l(){g("tagappend")}he();var c=jn(),d=le(c),h=ne(d);Ct(h,{children:(s,D)=>{var $=Wn(),I=le($);ze(I,{get icon(){return vn}});var R=G(I,2);ze(R,{get icon(){return pn}}),P(s,$)},$$slots:{default:!0}});var C=G(h,2),T=ne(C);ye(T,t,"default",{}),V(C),V(d);var v=G(d,2);Le(v,{get keyCombination(){return m()},$$events:{action:()=>g("tagappend")}}),Q((s,D)=>{Ne(d,"title",`${s!=null?s:""} (${D!=null?D:""})`),Ne(d,"tabindex",w()?-1:0)},[()=>(re(Xt),ge(()=>Zt())),()=>(re($e),re(m()),ge(()=>$e(m())))],z),E("click",d,l),E("focus",d,l),P(a,c),fe(),i()}var Mn=B('<div class="tags-selected-button svelte-y9jxqs" role="button" tabindex="0"><!></div>'),Bn=B("<!> <!> <!>",1);function Ln(a,t){ue(t,!1);const f=me();let i=x(!1);const{selectAllShortcut:w,copyShortcut:m,removeShortcut:g}=yt(Xe);he(),At(a,{get show(){return e(i)},preferredPlacement:"top",portalTarget:document.body,shift:0,children:Ie,$$slots:{default:(l,c)=>{const d=z(()=>c.asReference);var h=Mn(),C=Jt(()=>cn(()=>u(i,!e(i)))),T=ne(h);Ct(T,{children:(v,s)=>{ze(v,{get icon(){return bn}})},$$slots:{default:!0}}),V(h),Ge(h,v=>{var s;return(s=e(d))==null?void 0:s(v)}),te(()=>E("click",h,()=>u(i,!e(i)))),te(()=>E("keydown",h,function(...v){var s;(s=e(C))==null||s.apply(this,v)})),P(l,h)},floating:(l,c)=>{Nt(l,{slot:"floating",children:(d,h)=>{var C=Bn(),T=le(C);Ue(T,{$$events:{click:()=>f("tagselectall")},children:(D,$)=>{we();var I=De();Q((R,W)=>de(I,`${R!=null?R:""} (${W!=null?W:""})`),[()=>en(),()=>$e(w)],z),P(D,I)},$$slots:{default:!0}});var v=G(T,2);Ue(v,{$$events:{click:()=>f("tagcopy")},children:(D,$)=>{we();var I=De();Q((R,W)=>de(I,`${R!=null?R:""} (${W!=null?W:""})`),[()=>tn(),()=>$e(m)],z),P(D,I)},$$slots:{default:!0}});var s=G(v,2);Ue(s,{$$events:{click:()=>f("tagdelete")},children:(D,$)=>{we();var I=De();Q((R,W)=>de(I,`${R!=null?R:""} (${W!=null?W:""})`),[()=>nn(),()=>$e(g)],z),P(D,I)},$$slots:{default:!0}}),P(d,C)},$$slots:{default:!0}})}}}),fe()}var qn=B('<div class="tag-options-button gap svelte-16efk4p"><!></div>');function On(a,t){let f=_(t,"badgeHeight",12),i=_(t,"tagsSelected",8),w=_(t,"keyCombination",8);var m=qn(),g=ne(m);mn(g,i,l=>{var c=_t(),d=le(c);{var h=T=>{Ln(T,{$$events:{tagselectall(v){O.call(this,t,v)},tagcopy(v){O.call(this,t,v)},tagdelete(v){O.call(this,t,v)}}})},C=T=>{xn(T,{get keyCombination(){return w()},$$events:{tagappend(v){O.call(this,t,v)}}})};Ae(d,T=>{i()?T(h):T(C,!1)})}P(l,c)}),V(m),wt(m,"offsetHeight",f),E("mousedown",m,ke(function(l){O.call(this,t,l)})),P(a,m)}function zn(a,t){let f=_(t,"class",8,"");Sn(a,{get class(){var i;return`d-flex align-items-center ms-1 ${(i=f())!=null?i:""}`},iconSize:80,$$events:{click(i){O.call(this,t,i)}},children:(i,w)=>{ze(i,{get icon(){return yn}})},$$slots:{default:!0}})}var Fn=B('<button tabindex="-1"><!></button>');function Je(a,t){ue(t,!1);let f=_(t,"class",8,""),i=_(t,"tagName",8),w=_(t,"tooltip",8,void 0),m=_(t,"selected",8,!1);const g=me();let l=x(!1);function c(){u(l,!0),setTimeout(()=>u(l,!1),300)}let d=x();bt(()=>g("mount",{button:e(d)})),he();var h=Fn();let C;var T=ne(h);return ye(T,t,"default",{}),V(h),Qe(h,v=>u(d,v),()=>e(d)),Q(v=>{var s;C=We(h,1,`tag d-inline-flex align-items-center text-nowrap ps-2 pe-1 ${(s=f())!=null?s:""}`,"svelte-1ywoj88",C,v),Ne(h,"title",w()),Ne(h,"data-addon-tag",i())},[()=>({selected:m(),flashing:e(l)})],z),E("mousemove",h,function(v){O.call(this,t,v)}),E("click",h,function(v){O.call(this,t,v)}),P(a,h),kt(t,"flash",c),fe({flash:c})}var Hn=B(" <!>",1),Kn=B("<span> </span> <!>",1),Un=B("<span> </span> <!>",1),Yn=B("<div><!></div>");function Jn(a,t){ue(t,!1);const[f,i]=Re(),w=()=>Ce(an,"$pageTheme",f),m=x();let g=_(t,"name",8),l=_(t,"class",8,""),c=_(t,"tooltip",8),d=_(t,"selected",12),h=_(t,"active",8),C=_(t,"shorten",8),T=_(t,"flash",12);const v=me();let s=x(!1),D=x(!1);function $(A){u(s,un(A)),u(D,fn(A))}function I(){e(D)?v("tagrange"):e(s)?v("tagselect"):v("tagclick")}function R(A){const M=A.split(oe);return M.length===1?A:`…${oe}`+M[M.length-1]}function W(A){return A.split(oe).length>1}const Z="tag-icon-hover";be(()=>(e(s),e(D)),()=>{u(m,e(s)||e(D))}),Fe(),he();var k=Yn();E("keydown",it.body,$),E("keyup",it.body,$);let F;var N=ne(k);{var b=A=>{Je(A,{get class(){return l()},get tagName(){return g()},$$events:{mousemove:$,click:I},children:(M,ae)=>{we();var se=Hn(),j=le(se),S=G(j);ye(S,t,"default",{get selectMode(){return e(m)},hoverClass:Z}),Q(()=>{var U;return de(j,`${(U=g())!=null?U:""} `)}),P(M,se)},$$slots:{default:!0}})},H=(A,M)=>{{var ae=j=>{Tn(j,{get tooltip(){return c()},trigger:"hover",placement:"top",children:Ie,$$slots:{default:(S,U)=>{const o=z(()=>U.createTooltip);Je(S,{get class(){return l()},get tagName(){return g()},get flash(){return T()},set flash(p){T(p)},get selected(){return d()},set selected(p){d(p)},$$events:{mousemove:$,click:I,mount:p=>e(o)(p.detail.button)},children:(p,L)=>{var Y=Kn(),K=le(Y),q=ne(K,!0);V(K);var ee=G(K,2);ye(ee,t,"default",{get selectMode(){return e(m)},hoverClass:Z}),Q(_e=>de(q,_e),[()=>(re(g()),ge(()=>R(g())))],z),P(p,Y)},$$slots:{default:!0},$$legacy:!0})}}})},se=j=>{Je(j,{get class(){return l()},get tagName(){return g()},get flash(){return T()},set flash(S){T(S)},get selected(){return d()},set selected(S){d(S)},$$events:{mousemove:$,click:I},children:(S,U)=>{var o=Un(),p=le(o),L=ne(p,!0);V(p);var Y=G(p,2);ye(Y,t,"default",{get selectMode(){return e(m)},hoverClass:Z}),Q(()=>de(L,g())),P(S,o)},$$slots:{default:!0},$$legacy:!0})};Ae(A,j=>{re(C()),re(g()),ge(()=>C()&&W(g()))?j(ae):j(se,!1)},M)}};Ae(N,A=>{h()?A(b):A(H,!1)})}V(k),Q(A=>F=We(k,1,"svelte-11ejbji",null,F,A),[()=>({"select-mode":e(m),"night-mode":w().isDark,empty:g()===""})],z),P(a,k),fe(),i()}function Vn(a,t){ue(t,!1);let f=_(t,"name",8),i=_(t,"class",8,""),w=_(t,"tooltip",8),m=_(t,"selected",8),g=_(t,"active",8),l=_(t,"shorten",8),c=_(t,"flash",8);const d=me();function h(){d("tagdelete")}he(),Jn(a,{get name(){return f()},get class(){return i()},get tooltip(){return w()},get selected(){return m()},get active(){return g()},get shorten(){return l()},get flash(){return c()},$$events:{tagrange(C){O.call(this,t,C)},tagselect(C){O.call(this,t,C)},tagclick:()=>d("tagedit")},children:Ie,$$slots:{default:(C,T)=>{const v=z(()=>T.selectMode),s=z(()=>T.hoverClass);zn(C,{get class(){return e(s)},$$events:{click:D=>{e(v)||(h(),D.stopPropagation())}}})}}}),fe()}var Gn=B('<div class="tag-spacer svelte-1k3couf" role="textbox" tabindex="-1"><br/></div>');function Qn(a,t){var f=Gn();E("click",f,function(i){O.call(this,t,i)}),P(a,f)}var Xn=B('<div tabindex="-1" role="button"><!></div>');function vt(a,t){ue(t,!1);let f=_(t,"selected",8,!1),i=_(t,"active",8,!1),w=_(t,"suggestion",8),m=x();be(()=>(re(f()),e(m)),()=>{f()&&e(m)&&e(m).scrollIntoViewIfNeeded({behavior:"smooth",block:"start"})}),Fe();var g=Xn();let l;var c=ne(g);ye(c,t,"default",{}),V(g),Qe(g,d=>u(m,d),()=>e(m)),Q(d=>{l=We(g,1,"autocomplete-item svelte-1pjq6zk",null,l,d),Ne(g,"data-addon-suggestion",w())},[()=>({selected:f(),active:i()})],z),E("mousedown",g,ke(function(d){O.call(this,t,d)})),E("mouseup",g,function(d){O.call(this,t,d)}),E("mouseenter",g,function(d){O.call(this,t,d)}),E("mouseleave",g,function(d){O.call(this,t,d)}),P(a,g),fe()}var Zn=B('<span class="autocomplete-reference svelte-1bkz961"><!></span>'),ea=B('<div class="autocomplete-menu svelte-1bkz961"></div>'),ta=B('<svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper>',1);function na(a,t){ue(t,!1);const[f,i]=Re(),w=()=>Ce(g(),"$show",f);let m=_(t,"suggestionsPromise",8),g=_(t,"show",8),l=x([]),c=x(null),d=x(!1);const h=me();function C(){e(c)===null?u(c,0):e(c)>=e(l).length-1?u(c,null):Oe(c)}function T(){e(c)===null?u(c,e(l).length-1):e(c)===0?u(c,null):Oe(c,-1)}async function v(){var b;h("select",{selected:e(l)[(b=e(c))!=null?b:-1]})}async function s(){C(),await v()}async function D(){T(),await v()}async function $(){var b;e(l).length&&(u(d,!0),h("choose",{chosen:e(l)[(b=e(c))!=null?b:-1]}),await X(),g().set(!1))}async function I(){await X(),h("update")}function R(){return e(c)!==null}function W(){return{selectPrevious:D,selectNext:s,chooseSelected:$,update:I,hasSelected:R}}function Z(b){u(c,b),u(d,!0)}function k(b){Z(b)}async function F(b){u(d,!1),h("select",{selected:e(l)[b]})}function N(b,H){b.buttons===1&&Z(H)}be(()=>(re(m()),re(g()),gt),()=>{m().then(b=>{g().set(b.length>0),gt()&&navigator.userAgent.match(/Chrome\/77/)&&(b=b.slice(0,10)),u(l,b)})}),Fe(),he(),At(a,{keepOnKeyup:!0,get show(){return w()},preferredPlacement:"top",portalTarget:ge(()=>document.body),$$events:{close:()=>g().set(!1)},children:Ie,$$slots:{default:(b,H)=>{const A=z(()=>H.asReference);var M=Zn(),ae=ne(M);ye(ae,t,"default",{createAutocomplete:W}),V(M),Ge(M,se=>{var j;return(j=e(A))==null?void 0:j(se)}),P(b,M)},floating:(b,H)=>{var A=ta(),M=le(A);St(M,()=>({"--popover-padding-inline":"0"})),Nt(M.lastChild,{slot:"floating",children:(ae,se)=>{var j=ea();Tt(j,5,()=>e(l),sn,(S,U,o)=>{var p=_t(),L=le(p);{var Y=q=>{vt(q,{selected:!0,get active(){return e(d)},get suggestion(){return e(U)},$$events:{mousedown:()=>k(o),mouseup:()=>{F(o),$()},mouseenter:ee=>N(ee,o),mouseleave:()=>u(d,!1)},children:(ee,_e)=>{we();var ve=De();Q(()=>de(ve,e(U))),P(ee,ve)},$$slots:{default:!0}})},K=q=>{vt(q,{get suggestion(){return e(U)},$$events:{mousedown:()=>k(o),mouseup:()=>{F(o),$()},mouseenter:ee=>N(ee,o)},children:(ee,_e)=>{we();var ve=De();Q(()=>de(ve,e(U))),P(ee,ve)},$$slots:{default:!0}})};Ae(L,q=>{o===e(c)?q(Y):q(K,!1)})}P(S,p)}),V(j),P(ae,j)},$$slots:{default:!0}}),V(M),P(b,A)}}}),fe(),i()}var aa=B("<!> <!> <!>",1),sa=B("<div><!> <!></div>"),oa=B('<!> <div class="tag-editor svelte-1j1pzq8"><svelte-css-wrapper style="display: contents"><!></svelte-css-wrapper> <!> <!></div>',1);function wa(a,t){ue(t,!1);const[f,i]=Re(),w=()=>Ce(d(),"$tags",f),m=()=>Ce($,"$show",f),g=x(),l=x(),c=x();let d=_(t,"tags",8),h=_(t,"keyCombination",8,"Control+Shift+T");const C="Control+A",T="Control+C",v="Backspace";Vt(Xe,{selectAllShortcut:C,copyShortcut:T,removeShortcut:v});let s=x();function D(n){u(s,n.map(r=>Ye(Ve(r))))}const $=pt(!1),I=me(),R=Promise.resolve([]);let W=x(R);function Z(){const n=e(s).map(r=>r.name).map(qe);I("tagsupdate",{tags:n}),u(W,R)}let k=x(null),F=null,N=x(""),b=x(),H=x(),A=x(!1);async function M(n){const{tags:r}=await hn({input:n,matchLimit:500});return r}const ae=/^:?([^:].*?[^:]):?$/;function se(){const r=e(s)[e(k)].name;if(u(A,r.length===0),e(A))u(W,R);else{const y=qe(r),J=ae.test(y)?y.replace(ae,"$1"):y;u(W,M(J).then(ce=>(u(A,ce.length===0),ce.map(Ve))))}}function j(n){const r=e(s)[e(k)];u(N,n!=null?n:r.name);const y=e(b).value.length;e(b).setSelectionRange(y,y)}async function S(n){n.name=e(N),u(s,e(s)),await X(),e(b)&&e(H).update()}function U(n){F===null&&(F=n)}function o(){Se();const n=e(s)[e(s).length-1];(!n||n.name.length>0)&&p(e(s).length-1,"");const r=e(k)===null;u(k,null),r&&tt()}function p(n,r){e(s).splice(n+1,0,Ye(r)),u(s,e(s)),U(n+1)}function L(n){const r=e(s).map(En);r.splice(n,1);const y=r.indexOf(e(N));return y>=0?(e(s)[y>=n?y+1:y].flash(),!1):!0}async function Y(n,r,y){const J=e(N).slice(0,r),ce=e(N).slice(y);u(N,J),await X(),p(n,ce),u(k,null),await X(),n!==e(k)&&e(b).setSelectionRange(0,0)}function K(n){L(n)&&(e(s).splice(n,0,Ye(e(N))),Oe(k),u(s,e(s)))}function q(n){const r=e(s).splice(n,1)[0];return u(s,e(s)),F!==null&&F>n&&F--,r}function ee(n){return n===0}function _e(n){return n===e(s).length-1}function ve(n){if(ee(n))return;const r=q(n-1);u(N,r.name+e(N)),Oe(k,-1),S(e(s)[e(k)])}function $t(n){if(_e(n))return;const r=q(n+1);u(N,e(N)+r.name),S(e(s)[e(k)])}function Et(n){ee(n)||(F=n-1,u(k,null),e(b).blur())}async function It(n){if(_e(n)){e(N).length!==0&&(p(n,""),u(k,null));return}F=n+1,u(k,null),e(b).blur(),await X(),e(b).setSelectionRange(0,0)}function Rt(n,r){e(s).includes(n)&&(L(r)||q(r))}function tt(){u(k,F),F=null}function Wt(n){if(dn(n)){e(H).selectPrevious(),n.preventDefault();return}else if(gn(n)){e(H).selectNext(),n.preventDefault();return}switch(n.code){case"Tab":if(m())n.shiftKey?e(H).selectPrevious():e(H).selectNext();else break;n.preventDefault();break;case"Enter":e(H).chooseSelected(),n.preventDefault();break}}let Pe=null,je=null;function nt(n){ft(s,e(s)[n].selected=!e(s)[n].selected),u(s,e(s)),Pe=n}function jt(n){if(Pe===null){nt(n);return}je=n;const r=Math.min(Pe,je),y=Math.max(Pe,je);for(let J=r;J<=y;J++)ft(s,e(s)[J].selected=!0);u(s,e(s))}function Se(){u(s,e(s).map(n=>({...n,selected:!1}))),Pe=null,je=null}function xt(n){const r=n.currentTarget;(n.relatedTarget===null||!r.contains(n.relatedTarget))&&Se()}function Mt(n){const r=document.createElement("textarea");r.value=n,r.setAttribute("readonly",""),r.style.position="absolute",r.style.left="-9999px",document.body.appendChild(r),r.select(),wn("copy"),document.body.removeChild(r)}function He(){for(const n of e(s))n.selected=!0;u(s,e(s))}function at(){const n=e(s).filter(r=>r.selected).map(r=>qe(r.name)).join(`
`);Mt(n),Se()}function st(){e(s).map((n,r)=>[n.selected,r]).filter(([n])=>n).reverse().forEach(([,n])=>q(n)),Se(),Z()}let Ke=x(),xe=x();be(()=>w(),()=>{D(w())}),be(()=>(e(Ke),e(xe)),()=>{u(g,Math.floor(e(Ke)/e(xe)))}),be(()=>(e(l),e(g)),()=>{u(l,e(l)||e(g)>2)}),be(()=>e(s),()=>{u(c,e(s).some(n=>n.selected))}),Fe(),he();var ot=oa(),lt=le(ot);{var Bt=n=>{var r=aa(),y=le(r);Le(y,{keyCombination:C,$$events:{action:He}});var J=G(y,2);Le(J,{keyCombination:T,$$events:{action:at}});var ce=G(J,2);Le(ce,{keyCombination:v,$$events:{action:st}}),P(n,r)};Ae(lt,n=>{e(c)&&n(Bt)})}var Me=G(lt,2),Be=ne(Me);St(Be,()=>({"--icon-align":"baseline"})),On(Be.lastChild,{get tagsSelected(){return e(c)},get keyCombination(){return h()},get badgeHeight(){return e(xe)},set badgeHeight(n){u(xe,n)},$$events:{tagselectall:He,tagcopy:at,tagdelete:st,tagappend:o},$$legacy:!0}),V(Be);var rt=G(Be,2);Tt(rt,3,()=>e(s),n=>n.id,(n,r,y)=>{var J=sa();let ce;var ct=ne(J);const Ot=z(()=>(re(e(y)),e(k),e(N),e(r),ge(()=>e(y)===e(k)?e(N):e(r).name))),zt=z(()=>e(y)===e(k));Vn(ct,{class:"ms-0",get name(){return e(Ot)},get tooltip(){return e(r),ge(()=>e(r).name)},get active(){return e(zt)},get shorten(){return e(l)},get flash(){return e(r).flash},set flash(ie){e(r).flash=ie,ut(()=>e(s))},get selected(){return e(r).selected},set selected(ie){e(r).selected=ie,ut(()=>e(s))},$$events:{tagedit:()=>{u(k,e(y)),Se()},tagselect:()=>nt(e(y)),tagrange:()=>jt(e(y)),tagdelete:()=>{Se(),q(e(y)),Z()}},$$legacy:!0});var Ft=G(ct,2);{var Ht=ie=>{na(ie,{get suggestionsPromise(){return e(W)},get show(){return $},$$events:{update:se,select:({detail:pe})=>j(pe.selected),choose:({detail:pe})=>{j(pe.chosen),Y(e(y),pe.chosen.length,pe.chosen.length)}},children:Ie,$$slots:{default:(pe,Kt)=>{const Ut=z(()=>Kt.createAutocomplete);Rn(pe,{get id(){return e(r),ge(()=>e(r).id)},class:"position-absolute start-0 top-0 bottom-0 ps-2 py-0",get disabled(){return e(A)},get name(){return e(N)},set name(Te){u(N,Te)},get input(){return e(b)},set input(Te){u(b,Te)},$$events:{focus:()=>{I("tagsFocused"),u(N,e(r).name),u(H,e(Ut)())},keydown:Wt,keyup:()=>{e(N).length===0&&($==null||$.set(!1))},taginput:()=>S(e(r)),tagsplit:({detail:Te})=>Y(e(y),Te.start,Te.end),tagadd:()=>K(e(y)),tagdelete:()=>q(e(y)),tagselectall:async()=>{e(s).length<=1||(e(b).blur(),await X(),He())},tagjoinprevious:()=>ve(e(y)),tagjoinnext:()=>$t(e(y)),tagmoveprevious:()=>Et(e(y)),tagmovenext:()=>It(e(y)),tagaccept:()=>{Rt(e(r),e(y)),e(r)&&S(e(r)),Z(),tt()}},$$legacy:!0})}}})};Ae(Ft,ie=>{e(y)===e(k)&&ie(Ht)})}V(J),Q(ie=>ce=We(J,1,"tag-relative svelte-1j1pzq8",null,ce,ie),[()=>({"hide-tag":e(y)===e(k)})],z),P(n,J)});var Lt=G(rt,2);Qn(Lt,{$$events:{click:o}}),V(Me),E("focusout",Me,xt),wt(Me,"offsetHeight",n=>u(Ke,n)),P(a,ot),kt(t,"appendEmptyTag",o);var qt=fe({appendEmptyTag:o});return i(),qt}export{wa as T,ka as d,wn as e};
